# 000.01.001 Ideation Spec

# Requirements Analysis
- Define an `IdeationSpec` JSON schema to capture: `goal`, `constraints`, `kpis`, `risk_appetite`, `data_sources`, `tooling_limits`, `metadata` (creator, timestamp), and `mode` ("ideation" | "selection" | "exit").
- Provide a form UI (VS Code Quick Pick / Webview form) which maps user input into the `p_start` token payload.
- Ensure schema validation and unit tests prevent invalid ideations from entering the loop.

# Feature Mapping
- Maps to: `kb/2.designPattern/pnmlYaml.md` (PNML token contract), `kb/3.component/vscodeBridge.md` (participant async), and new components: `pnml_ideation.schema.json` and `ideation_form` webview.
- Reuses `vscode_bridge.participant_async` to collect ideation payload.

# System Design
- Schema: JSON Schema v7 file `schema/ideation.spec.json` with required fields and types.
- Form: Webview that serializes inputs into the schema format and posts back to the extension host using existing `vscode_bridge` pending ops pattern.
- Tokenization: a serializer function `ideation_serializer.to_token(ideation_spec)` that injects the payload into `p_start` token structure.

# Implementation Strategy
Epics broken into stories (each story includes tasks and acceptance tests):

1.1 Story: Create `IdeationSpec` JSON schema
- Tasks:
  - Design schema file `schema/ideation.spec.json`.
  - Add schema unit tests (valid and invalid examples).
- Unit tests:
  - `test_schema_valid` (valid sample will pass validation).
  - `test_schema_missing_required` (missing `goal` should fail).
- Test data:
  - `samples/ideation/valid_001.json` (goal, constraints, kpis, risk_appetite: "moderate").
  - `samples/ideation/invalid_missing_goal.json`.

1.2 Story: Implement `ideation_form` UI and host integration
- Tasks:
  - Add webview form or quick-pick flow.
  - Hook into `vscode_bridge.participant_async` pattern.
- Unit tests (UI level using mocked bridge):
  - `test_form_renders` (checks form fields present).
  - `test_form_submits_valid_payload` (mock submission resolves to token).
- Test data: `samples/ideation/valid_001.json`.

1.3 Story: Implement serializer and token injection
- Tasks:
  - Implement `ideation_serializer.to_token` (Python) that converts schema into PNML token shape.
  - Unit tests: `test_serializer_roundtrip` (serialize -> deserialize preserves fields).
- Test data: `samples/ideation/valid_001.json`.

1.4 Story: Hook schema validation into `pnml_generator` input stage
- Tasks:
  - Validate incoming ideation payload before generating PNML.
  - Unit tests: `test_generator_rejects_invalid_ideation` and `test_generator_accepts_valid_ideation`.
- Test data: valid and invalid samples above.

# Testing Strategy
- Unit tests for each story placed under `tests/` (pytest) and run in CI.
- Integration test (automated): `tests/integration/test_ideation_to_pnml.py`
  - Steps:
    1. Start a test instance of `vscode_bridge` (mock) that returns `valid_001.json` payload when invoked.
    2. Fire `t_input` transition in the net with the returned token.
    3. Assert `pnml_generator.from_ideation` produces valid PNML (schema-validated) and that a token is placed on `p_generated_pnml`.
  - Test data: `samples/ideation/valid_001.json`.

---

# Automation & CI
- Add the unit tests to the `pytest` suite and mark integration test as `integration` so CI can run on scheduled runs or PRs. Use fixtures for mocked bridge and sample files.
